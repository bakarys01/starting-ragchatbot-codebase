<svg width="1000" height="800" xmlns="http://www.w3.org/2000/svg">
  <!-- Background -->
  <rect width="1000" height="800" fill="#f8f9fa"/>
  
  <!-- Title -->
  <text x="500" y="30" text-anchor="middle" font-size="24" font-weight="bold" fill="#2c3e50">
    RAG Chatbot Query Processing Flow
  </text>
  
  <!-- Frontend Layer -->
  <rect x="50" y="60" width="200" height="120" fill="#e8f4fd" stroke="#3498db" stroke-width="2" rx="5"/>
  <text x="150" y="85" text-anchor="middle" font-weight="bold" fill="#2980b9">Frontend (JS)</text>
  <text x="150" y="105" text-anchor="middle" font-size="12" fill="#34495e">User Input</text>
  <text x="150" y="120" text-anchor="middle" font-size="12" fill="#34495e">sendMessage()</text>
  <text x="150" y="135" text-anchor="middle" font-size="12" fill="#34495e">POST /api/query</text>
  <text x="150" y="150" text-anchor="middle" font-size="12" fill="#34495e">UI Updates</text>
  
  <!-- API Layer -->
  <rect x="300" y="60" width="200" height="120" fill="#fdf2e9" stroke="#e67e22" stroke-width="2" rx="5"/>
  <text x="400" y="85" text-anchor="middle" font-weight="bold" fill="#d35400">FastAPI Endpoint</text>
  <text x="400" y="105" text-anchor="middle" font-size="12" fill="#34495e">app.py</text>
  <text x="400" y="120" text-anchor="middle" font-size="12" fill="#34495e">query_documents()</text>
  <text x="400" y="135" text-anchor="middle" font-size="12" fill="#34495e">Session Management</text>
  <text x="400" y="150" text-anchor="middle" font-size="12" fill="#34495e">QueryResponse</text>
  
  <!-- RAG System -->
  <rect x="550" y="60" width="200" height="120" fill="#ebf5ff" stroke="#3498db" stroke-width="2" rx="5"/>
  <text x="650" y="85" text-anchor="middle" font-weight="bold" fill="#2980b9">RAG System</text>
  <text x="650" y="105" text-anchor="middle" font-size="12" fill="#34495e">rag_system.py</text>
  <text x="650" y="120" text-anchor="middle" font-size="12" fill="#34495e">query()</text>
  <text x="650" y="135" text-anchor="middle" font-size="12" fill="#34495e">History Retrieval</text>
  <text x="650" y="150" text-anchor="middle" font-size="12" fill="#34495e">Response + Sources</text>
  
  <!-- AI Generator -->
  <rect x="800" y="60" width="150" height="120" fill="#f0fff4" stroke="#27ae60" stroke-width="2" rx="5"/>
  <text x="875" y="85" text-anchor="middle" font-weight="bold" fill="#27ae60">AI Generator</text>
  <text x="875" y="105" text-anchor="middle" font-size="12" fill="#34495e">ai_generator.py</text>
  <text x="875" y="120" text-anchor="middle" font-size="12" fill="#34495e">OpenAI GPT-4o</text>
  <text x="875" y="135" text-anchor="middle" font-size="12" fill="#34495e">Tool Calling</text>
  <text x="875" y="150" text-anchor="middle" font-size="12" fill="#34495e">Function Calls</text>
  
  <!-- Tool Manager -->
  <rect x="200" y="250" width="180" height="100" fill="#fff5f5" stroke="#e74c3c" stroke-width="2" rx="5"/>
  <text x="290" y="275" text-anchor="middle" font-weight="bold" fill="#c0392b">Tool Manager</text>
  <text x="290" y="295" text-anchor="middle" font-size="12" fill="#34495e">search_tools.py</text>
  <text x="290" y="310" text-anchor="middle" font-size="12" fill="#34495e">execute_tool()</text>
  <text x="290" y="325" text-anchor="middle" font-size="12" fill="#34495e">Source Tracking</text>
  
  <!-- Course Search Tool -->
  <rect x="420" y="250" width="180" height="100" fill="#fef9e7" stroke="#f39c12" stroke-width="2" rx="5"/>
  <text x="510" y="275" text-anchor="middle" font-weight="bold" fill="#e67e22">Course Search Tool</text>
  <text x="510" y="295" text-anchor="middle" font-size="12" fill="#34495e">CourseSearchTool</text>
  <text x="510" y="310" text-anchor="middle" font-size="12" fill="#34495e">execute()</text>
  <text x="510" y="325" text-anchor="middle" font-size="12" fill="#34495e">Format Results</text>
  
  <!-- Vector Store -->
  <rect x="640" y="250" width="180" height="100" fill="#f4f6ff" stroke="#6c5ce7" stroke-width="2" rx="5"/>
  <text x="730" y="275" text-anchor="middle" font-weight="bold" fill="#6c5ce7">Vector Store</text>
  <text x="730" y="295" text-anchor="middle" font-size="12" fill="#34495e">vector_store.py</text>
  <text x="730" y="310" text-anchor="middle" font-size="12" fill="#34495e">search()</text>
  <text x="730" y="325" text-anchor="middle" font-size="12" fill="#34495e">Similarity Query</text>
  
  <!-- ChromaDB -->
  <rect x="400" y="400" width="200" height="100" fill="#f8f9fa" stroke="#6c757d" stroke-width="2" rx="5"/>
  <text x="500" y="425" text-anchor="middle" font-weight="bold" fill="#495057">ChromaDB</text>
  <text x="500" y="445" text-anchor="middle" font-size="12" fill="#34495e">Vector Database</text>
  <text x="500" y="460" text-anchor="middle" font-size="12" fill="#34495e">Embeddings</text>
  <text x="500" y="475" text-anchor="middle" font-size="12" fill="#34495e">Metadata</text>
  
  <!-- Document Collections -->
  <rect x="100" y="550" width="150" height="80" fill="#e8f5e8" stroke="#28a745" stroke-width="2" rx="5"/>
  <text x="175" y="575" text-anchor="middle" font-weight="bold" fill="#155724">Course Catalog</text>
  <text x="175" y="595" text-anchor="middle" font-size="12" fill="#34495e">Course Metadata</text>
  <text x="175" y="610" text-anchor="middle" font-size="12" fill="#34495e">Titles & Links</text>
  
  <rect x="300" y="550" width="150" height="80" fill="#fff3cd" stroke="#ffc107" stroke-width="2" rx="5"/>
  <text x="375" y="575" text-anchor="middle" font-weight="bold" fill="#856404">Course Content</text>
  <text x="375" y="595" text-anchor="middle" font-size="12" fill="#34495e">Text Chunks</text>
  <text x="375" y="610" text-anchor="middle" font-size="12" fill="#34495e">Lesson Context</text>
  
  <!-- Data Sources -->
  <rect x="550" y="550" width="150" height="80" fill="#d4edda" stroke="#28a745" stroke-width="2" rx="5"/>
  <text x="625" y="575" text-anchor="middle" font-weight="bold" fill="#155724">Course Files</text>
  <text x="625" y="595" text-anchor="middle" font-size="12" fill="#34495e">docs/</text>
  <text x="625" y="610" text-anchor="middle" font-size="12" fill="#34495e">*.txt files</text>
  
  <!-- Session Manager -->
  <rect x="750" y="550" width="150" height="80" fill="#e2e3f1" stroke="#6f42c1" stroke-width="2" rx="5"/>
  <text x="825" y="575" text-anchor="middle" font-weight="bold" fill="#6f42c1">Session Manager</text>
  <text x="825" y="595" text-anchor="middle" font-size="12" fill="#34495e">Conversation</text>
  <text x="825" y="610" text-anchor="middle" font-size="12" fill="#34495e">History</text>
  
  <!-- Flow Arrows -->
  
  <!-- Frontend to API -->
  <path d="M250 120 L300 120" stroke="#2c3e50" stroke-width="2" marker-end="url(#arrowhead)" fill="none"/>
  
  <!-- API to RAG System -->
  <path d="M500 120 L550 120" stroke="#2c3e50" stroke-width="2" marker-end="url(#arrowhead)" fill="none"/>
  
  <!-- RAG to AI Generator -->
  <path d="M750 120 L800 120" stroke="#2c3e50" stroke-width="2" marker-end="url(#arrowhead)" fill="none"/>
  
  <!-- AI Generator to Tool Manager (conditional) -->
  <path d="M875 180 Q875 215 290 215 L290 250" stroke="#e74c3c" stroke-width="2" marker-end="url(#arrowhead)" fill="none" stroke-dasharray="5,5"/>
  
  <!-- Tool Manager to Search Tool -->
  <path d="M380 300 L420 300" stroke="#2c3e50" stroke-width="2" marker-end="url(#arrowhead)" fill="none"/>
  
  <!-- Search Tool to Vector Store -->
  <path d="M600 300 L640 300" stroke="#2c3e50" stroke-width="2" marker-end="url(#arrowhead)" fill="none"/>
  
  <!-- Vector Store to ChromaDB -->
  <path d="M730 350 L500 400" stroke="#2c3e50" stroke-width="2" marker-end="url(#arrowhead)" fill="none"/>
  
  <!-- ChromaDB to Collections -->
  <path d="M450 500 L200 550" stroke="#2c3e50" stroke-width="2" marker-end="url(#arrowhead)" fill="none"/>
  <path d="M500 500 L375 550" stroke="#2c3e50" stroke-width="2" marker-end="url(#arrowhead)" fill="none"/>
  
  <!-- Data Sources to Collections -->
  <path d="M625 550 L425 530" stroke="#28a745" stroke-width="2" marker-end="url(#arrowhead)" fill="none"/>
  
  <!-- Session Manager to RAG -->
  <path d="M750 590 Q700 540 650 180" stroke="#6f42c1" stroke-width="2" marker-end="url(#arrowhead)" fill="none" stroke-dasharray="3,3"/>
  
  <!-- Return Flow (simplified) -->
  <path d="M500 400 Q200 450 150 180" stroke="#27ae60" stroke-width="3" marker-end="url(#arrowhead-green)" fill="none"/>
  
  <!-- Flow Labels -->
  <text x="275" y="110" text-anchor="middle" font-size="10" fill="#2c3e50">HTTP Request</text>
  <text x="525" y="110" text-anchor="middle" font-size="10" fill="#2c3e50">Process Query</text>
  <text x="775" y="110" text-anchor="middle" font-size="10" fill="#2c3e50">Generate Response</text>
  <text x="335" y="235" text-anchor="middle" font-size="10" fill="#e74c3c">Tool Call (if needed)</text>
  <text x="400" y="290" text-anchor="middle" font-size="10" fill="#2c3e50">Execute</text>
  <text x="620" y="290" text-anchor="middle" font-size="10" fill="#2c3e50">Search</text>
  <text x="615" y="375" text-anchor="middle" font-size="10" fill="#2c3e50">Vector Query</text>
  <text x="125" y="400" text-anchor="middle" font-size="12" fill="#27ae60" transform="rotate(-45 125 400)">Response Flow</text>
  
  <!-- Legend -->
  <rect x="50" y="680" width="900" height="100" fill="#ffffff" stroke="#dee2e6" stroke-width="1" rx="5"/>
  <text x="70" y="705" font-weight="bold" fill="#2c3e50">Flow Description:</text>
  <text x="70" y="725" font-size="12" fill="#34495e">1. User submits query through frontend → 2. FastAPI receives request → 3. RAG System processes</text>
  <text x="70" y="740" font-size="12" fill="#34495e">4. OpenAI GPT-4o generates response (may call search tool) → 5. Vector search in ChromaDB</text>
  <text x="70" y="755" font-size="12" fill="#34495e">6. Results formatted with sources → 7. Response returned to user with context</text>
  
  <!-- Arrow Definitions -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#2c3e50"/>
    </marker>
    <marker id="arrowhead-green" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#27ae60"/>
    </marker>
  </defs>
</svg>